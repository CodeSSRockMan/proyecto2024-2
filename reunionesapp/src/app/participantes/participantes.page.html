<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Participantes</ion-title>
  </ion-toolbar>
</ion-header>

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

<ion-content [fullscreen]="true" (ionScroll)="onScroll($event)">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Participantes</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="container mt-3">
    <div *ngFor="let participante of participantes" class="card mb-3" [class.sin-fechas]="!participante.fechasElegidas" [class.con-fechas]="participante.fechasElegidas" style="position: relative;">
      <div class="card-body d-flex justify-content-between align-items-center" style="height: 70px;margin-bottom: 5px; overflow: hidden;">
        <!-- Ícono de alerta si no ha elegido fechas -->
        <ion-icon *ngIf="!participante.fechasElegidas" name="alert-circle" class="text-danger mr-2"></ion-icon>
        <!-- Ícono de confirmación si ha elegido fechas y no está en modo de edición -->
        <ion-icon *ngIf="participante.fechasElegidas && !participante.editando" name="checkmark-circle" class="text-success mr-2"></ion-icon>

        <!-- Primera división horizontal -->
        <div class="d-flex align-items-center w-75">
          <!-- División horizontal para nombre y botón de editar -->
          <div class="d-flex align-items-center">
            <!-- Campo de nombre o edición -->
            <ng-container *ngIf="!participante.editando; else editingMode">
              <h5 *ngIf="!participante.editando" class="card-title mb-0 mr-1 fixed-width-nombre moving-text" [class.edicion]="participante.editando">{{ participante.nombre }}</h5>
            </ng-container>
            <ng-template #editingMode>
              <input type="text" class="custom-input fixed-width" [(ngModel)]="participante.nombre">
            </ng-template>

            <!-- Botón de editar -->
            <button *ngIf="!participante.editando" type="button" class="btn btn-link p-0" style="margin-top: -5px;" (click)="toggleEdicion(participante)">
              <ion-icon name="create-outline"></ion-icon>
            </button>
          </div>
        </div>
        
        <!-- Segunda división horizontal - Teléfono y botones de acción -->
        <div class="d-flex align-items-center justify-content-end w-25">
          <!-- División vertical para teléfono -->
          <div class="d-flex flex-column ml-3">
            <!-- Campo de teléfono -->
            <p *ngIf="!participante.editando" class="card-text mb-0 font-weight-bold" [class.edicion]="participante.editando">{{ participante.telefono }}</p>
            <input *ngIf="participante.editando" type="text" class="custom-input fixed-width-telefono" [(ngModel)]="participante.telefono">
            
            <!-- Botones de acción -->
            <div class="btn-group mt-2" role="group" aria-label="Acciones">
              <button type="button" class="btn btn-outline-primary" (click)="llamar(participante.telefono)">
                <ion-icon name="call-outline"></ion-icon>
              </button>
              <button type="button" class="btn btn-outline-success" (click)="enviarWhatsapp(participante.telefono)">
                <ion-icon name="logo-whatsapp"></ion-icon>
              </button>
              <button type="button" class="btn btn-outline-danger" (click)="confirmarEliminacion(participante)">
                <ion-icon name="trash-outline"></ion-icon>
              </button>
              <!-- Botón de guardar cambios -->
              <button *ngIf="participante.editando" type="button" class="btn btn-outline-primary" (click)="confirmarEdicion(participante)">
                <ion-icon name="save-outline"></ion-icon>
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Botón para añadir nuevo participante -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="agregarParticipante()">
      <ion-icon name="person-add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>
